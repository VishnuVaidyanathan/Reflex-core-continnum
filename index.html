<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reflex Core Continuum ‚Äî Live Demo</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,300;0,400;0,500;1,300&family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,700;1,9..144,400&family=DM+Sans:wght@300;400;500&display=swap');

  :root {
    --bg: #060810;
    --surface: #0d1120;
    --surface2: #141828;
    --border: #1e2840;
    --accent-blue: #4a9eff;
    --accent-teal: #3dd9c0;
    --accent-amber: #f5a623;
    --accent-rose: #ff6b8a;
    --accent-violet: #a78bfa;
    --text: #e8eaf2;
    --text-dim: #8892b0;
    --text-faint: #3d4a6b;
    --glow-blue: rgba(74,158,255,0.15);
    --glow-teal: rgba(61,217,192,0.15);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Animated grid background */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(74,158,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(74,158,255,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  /* Floating orbs */
  .orb {
    position: fixed;
    border-radius: 50%;
    filter: blur(80px);
    pointer-events: none;
    z-index: 0;
    animation: drift 20s ease-in-out infinite alternate;
  }
  .orb1 { width: 400px; height: 400px; background: rgba(74,158,255,0.06); top: -100px; left: -100px; animation-delay: 0s; }
  .orb2 { width: 300px; height: 300px; background: rgba(61,217,192,0.06); bottom: 100px; right: -50px; animation-delay: -7s; }
  .orb3 { width: 200px; height: 200px; background: rgba(167,139,250,0.05); top: 50%; left: 40%; animation-delay: -14s; }

  @keyframes drift {
    from { transform: translate(0,0) scale(1); }
    to { transform: translate(30px, 20px) scale(1.1); }
  }

  .wrapper { position: relative; z-index: 1; max-width: 1100px; margin: 0 auto; padding: 40px 24px 80px; }

  /* Header */
  header { text-align: center; margin-bottom: 48px; }
  .header-tag {
    display: inline-block;
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.15em;
    color: var(--accent-teal);
    text-transform: uppercase;
    border: 1px solid rgba(61,217,192,0.3);
    padding: 4px 12px;
    border-radius: 2px;
    margin-bottom: 20px;
  }
  h1 {
    font-family: 'Fraunces', serif;
    font-size: clamp(32px, 5vw, 52px);
    font-weight: 700;
    line-height: 1.1;
    color: var(--text);
    margin-bottom: 12px;
  }
  h1 span { color: var(--accent-blue); font-style: italic; }
  .subtitle {
    color: var(--text-dim);
    font-size: 15px;
    font-weight: 300;
    max-width: 500px;
    margin: 0 auto;
    line-height: 1.6;
  }

  /* Main layout */
  .main-grid {
    display: grid;
    grid-template-columns: 1fr 360px;
    gap: 20px;
    align-items: start;
  }

  /* Chat panel */
  .chat-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    height: 620px;
  }

  .panel-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
    background: var(--surface2);
  }
  .panel-header-dots { display: flex; gap: 6px; }
  .dot { width: 10px; height: 10px; border-radius: 50%; }
  .dot-r { background: #ff6b8a; }
  .dot-y { background: #f5a623; }
  .dot-g { background: #3dd9c0; }
  .panel-title {
    font-family: 'DM Mono', monospace;
    font-size: 12px;
    color: var(--text-dim);
    margin-left: 4px;
  }
  .turn-counter {
    margin-left: auto;
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--text-faint);
  }
  .turn-counter span { color: var(--accent-blue); }

  /* Messages */
  .messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 14px;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }

  .msg {
    display: flex;
    gap: 10px;
    animation: msgIn 0.3s ease forwards;
    opacity: 0;
    transform: translateY(8px);
  }
  @keyframes msgIn {
    to { opacity: 1; transform: translateY(0); }
  }

  .msg-avatar {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    font-weight: 500;
    margin-top: 2px;
  }
  .msg.user .msg-avatar { background: linear-gradient(135deg, #4a9eff, #a78bfa); color: white; font-family: 'DM Mono', monospace; font-size: 11px; }
  .msg.system .msg-avatar { background: linear-gradient(135deg, #3dd9c0, #4a9eff); }

  .msg-content { flex: 1; }
  .msg-name {
    font-size: 11px;
    font-family: 'DM Mono', monospace;
    color: var(--text-faint);
    margin-bottom: 5px;
  }
  .msg.user .msg-name { color: var(--accent-violet); }
  .msg.system .msg-name { color: var(--accent-teal); }

  .msg-bubble {
    padding: 10px 14px;
    border-radius: 2px 12px 12px 12px;
    font-size: 14px;
    line-height: 1.6;
    font-weight: 300;
  }
  .msg.user .msg-bubble {
    background: rgba(167,139,250,0.08);
    border: 1px solid rgba(167,139,250,0.15);
    border-radius: 12px 2px 12px 12px;
    color: var(--text);
  }
  .msg.system .msg-bubble {
    background: rgba(74,158,255,0.06);
    border: 1px solid rgba(74,158,255,0.12);
    color: var(--text);
  }

  /* State badge on system message */
  .state-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    margin-top: 8px;
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    padding: 3px 8px;
    border-radius: 20px;
    background: rgba(61,217,192,0.08);
    border: 1px solid rgba(61,217,192,0.2);
    color: var(--accent-teal);
  }
  .state-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--accent-teal); animation: pulse 1.5s ease-in-out infinite; }
  @keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.3; } }

  /* Input area */
  .input-area {
    padding: 16px 20px;
    border-top: 1px solid var(--border);
    background: var(--surface2);
    display: flex;
    gap: 10px;
    align-items: flex-end;
  }
  textarea {
    flex: 1;
    background: rgba(255,255,255,0.04);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    padding: 10px 14px;
    resize: none;
    outline: none;
    min-height: 42px;
    max-height: 100px;
    transition: border-color 0.2s;
    line-height: 1.5;
  }
  textarea:focus { border-color: rgba(74,158,255,0.4); }
  textarea::placeholder { color: var(--text-faint); }

  .send-btn {
    width: 42px; height: 42px;
    border-radius: 8px;
    background: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.2s, transform 0.1s;
    flex-shrink: 0;
  }
  .send-btn:hover { opacity: 0.85; }
  .send-btn:active { transform: scale(0.95); }
  .send-btn svg { width: 16px; height: 16px; fill: white; }
  .send-btn:disabled { opacity: 0.4; cursor: not-allowed; }

  /* Right panel ‚Äî metrics */
  .metrics-panel { display: flex; flex-direction: column; gap: 16px; }

  .metric-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 18px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.3s;
  }
  .metric-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: var(--card-accent, var(--accent-blue));
    opacity: 0.6;
  }

  .metric-label {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--text-faint);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .metric-label-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--card-accent, var(--accent-blue)); }

  /* Bar meters */
  .meter-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
  }
  .meter-name {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--text-dim);
    width: 70px;
    flex-shrink: 0;
  }
  .meter-bar-bg {
    flex: 1;
    height: 6px;
    background: rgba(255,255,255,0.05);
    border-radius: 3px;
    overflow: hidden;
  }
  .meter-bar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    background: var(--bar-color, var(--accent-blue));
    position: relative;
  }
  .meter-bar-fill::after {
    content: '';
    position: absolute;
    right: 0; top: 0; bottom: 0;
    width: 4px;
    background: white;
    opacity: 0.5;
    border-radius: 3px;
    filter: blur(2px);
  }
  .meter-val {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--text-dim);
    width: 32px;
    text-align: right;
    flex-shrink: 0;
  }

  /* Ripple direction indicator */
  .ripple-indicator {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 6px;
  }
  .ripple-arrow {
    font-size: 22px;
    transition: all 0.5s ease;
    filter: drop-shadow(0 0 6px currentColor);
  }
  .ripple-label {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--text-dim);
  }
  .ripple-val {
    font-family: 'DM Mono', monospace;
    font-size: 18px;
    font-weight: 500;
    transition: all 0.5s ease;
  }

  /* Phase display */
  .phase-display {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .phase-icon {
    width: 44px; height: 44px;
    border-radius: 10px;
    background: linear-gradient(135deg, var(--card-accent, var(--accent-blue)), transparent);
    border: 1px solid rgba(255,255,255,0.08);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    flex-shrink: 0;
  }
  .phase-name {
    font-family: 'Fraunces', serif;
    font-size: 15px;
    color: var(--text);
    line-height: 1.3;
  }
  .phase-desc {
    font-size: 11px;
    color: var(--text-dim);
    font-weight: 300;
    margin-top: 2px;
  }

  /* Dominance bar */
  .dominance-bar {
    height: 10px;
    background: var(--surface2);
    border-radius: 5px;
    overflow: hidden;
    margin-top: 10px;
    position: relative;
    border: 1px solid var(--border);
  }
  .dominance-reflex {
    position: absolute;
    left: 0; top: 0; bottom: 0;
    background: linear-gradient(90deg, var(--accent-rose), var(--accent-amber));
    border-radius: 5px;
    transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .dominance-adaptive {
    position: absolute;
    right: 0; top: 0; bottom: 0;
    background: linear-gradient(90deg, var(--accent-teal), var(--accent-blue));
    border-radius: 5px;
    transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  .dominance-labels {
    display: flex;
    justify-content: space-between;
    margin-top: 6px;
  }
  .dom-label {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
    color: var(--text-faint);
  }
  .dom-val {
    font-family: 'DM Mono', monospace;
    font-size: 10px;
  }
  .dom-val.reflex { color: var(--accent-rose); }
  .dom-val.adaptive { color: var(--accent-teal); }

  /* Conscience level display */
  .conscience-levels {
    display: flex;
    flex-direction: column;
    gap: 5px;
    margin-top: 4px;
  }
  .conscience-level {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 5px 8px;
    border-radius: 5px;
    background: rgba(255,255,255,0.02);
    border: 1px solid transparent;
    transition: all 0.4s ease;
    font-size: 11px;
  }
  .conscience-level.active {
    background: rgba(167,139,250,0.08);
    border-color: rgba(167,139,250,0.2);
  }
  .conscience-level-num {
    font-family: 'DM Mono', monospace;
    width: 16px;
    color: var(--text-faint);
    font-size: 10px;
  }
  .conscience-level.active .conscience-level-num { color: var(--accent-violet); }
  .conscience-level-name {
    color: var(--text-dim);
    flex: 1;
  }
  .conscience-level.active .conscience-level-name { color: var(--text); }
  .conscience-level-dot {
    width: 6px; height: 6px; border-radius: 50%;
    background: var(--text-faint);
    transition: all 0.4s;
  }
  .conscience-level.active .conscience-level-dot {
    background: var(--accent-violet);
    box-shadow: 0 0 6px var(--accent-violet);
  }

  /* Quick prompts */
  .quick-prompts {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    padding: 0 20px 12px;
  }
  .qp {
    font-size: 12px;
    padding: 5px 10px;
    border-radius: 20px;
    background: rgba(255,255,255,0.04);
    border: 1px solid var(--border);
    color: var(--text-dim);
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'DM Mono', monospace;
  }
  .qp:hover { background: rgba(74,158,255,0.08); border-color: rgba(74,158,255,0.3); color: var(--accent-blue); }

  /* Typing indicator */
  .typing-indicator {
    display: flex;
    gap: 4px;
    align-items: center;
    padding: 8px 12px;
    background: rgba(74,158,255,0.06);
    border: 1px solid rgba(74,158,255,0.12);
    border-radius: 2px 12px 12px 12px;
    width: fit-content;
  }
  .typing-dot {
    width: 6px; height: 6px; border-radius: 50%;
    background: var(--accent-blue);
    animation: typingBounce 1.2s ease-in-out infinite;
  }
  .typing-dot:nth-child(2) { animation-delay: 0.2s; }
  .typing-dot:nth-child(3) { animation-delay: 0.4s; }
  @keyframes typingBounce {
    0%,60%,100% { transform: translateY(0); opacity: 0.5; }
    30% { transform: translateY(-4px); opacity: 1; }
  }

  /* Flash effect on metric update */
  @keyframes flashUpdate {
    0% { background: rgba(74,158,255,0.15); }
    100% { background: var(--surface); }
  }
  .metric-card.updated { animation: flashUpdate 0.6s ease; }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  /* Still layer overlay */
  .still-overlay {
    position: absolute;
    inset: 0;
    background: rgba(6,8,16,0.85);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    border-radius: 16px;
    backdrop-filter: blur(4px);
    z-index: 10;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s;
  }
  .still-overlay.active { opacity: 1; pointer-events: all; }
  .still-text {
    font-family: 'Fraunces', serif;
    font-size: 20px;
    font-style: italic;
    color: var(--text-dim);
    text-align: center;
  }
  .still-sub {
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    color: var(--text-faint);
    letter-spacing: 0.1em;
  }
  .still-resume {
    margin-top: 8px;
    padding: 8px 20px;
    background: rgba(74,158,255,0.1);
    border: 1px solid rgba(74,158,255,0.3);
    color: var(--accent-blue);
    border-radius: 6px;
    cursor: pointer;
    font-family: 'DM Mono', monospace;
    font-size: 12px;
    transition: all 0.2s;
  }
  .still-resume:hover { background: rgba(74,158,255,0.2); }

  /* Reset */
  .reset-btn {
    display: block;
    width: 100%;
    padding: 10px;
    background: rgba(255,107,138,0.06);
    border: 1px solid rgba(255,107,138,0.2);
    color: var(--accent-rose);
    border-radius: 8px;
    cursor: pointer;
    font-family: 'DM Mono', monospace;
    font-size: 11px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    transition: all 0.2s;
    margin-top: 4px;
  }
  .reset-btn:hover { background: rgba(255,107,138,0.12); }

  @media (max-width: 768px) {
    .main-grid { grid-template-columns: 1fr; }
    .chat-panel { height: 500px; }
  }
</style>
</head>
<body>
<div class="orb orb1"></div>
<div class="orb orb2"></div>
<div class="orb orb3"></div>

<div class="wrapper">
  <header>
    <div class="header-tag">Live Architecture Demo</div>
    <h1>Reflex Core <span>Continuum</span></h1>
    <p class="subtitle">Watch the emotional architecture evolve in real-time as you converse ‚Äî Echo, Ripple, Virtue, and Conscience responding to every word.</p>
  </header>

  <div class="main-grid">

    <!-- Chat Panel -->
    <div style="position:relative;">
      <div class="chat-panel" id="chatPanel">
        <div class="panel-header">
          <div class="panel-header-dots">
            <div class="dot dot-r"></div>
            <div class="dot dot-y"></div>
            <div class="dot dot-g"></div>
          </div>
          <span class="panel-title">reflex-core / conversation</span>
          <span class="turn-counter">Turn <span id="turnNum">0</span></span>
        </div>

        <div class="messages" id="messages">
          <div class="msg system">
            <div class="msg-avatar">üß†</div>
            <div class="msg-content">
              <div class="msg-name">MITHRA ¬∑ Reflex Core</div>
              <div class="msg-bubble">
                Hello! I'm Mithra. I can chat about anything ‚Äî tell me a joke, ask me something interesting, share how you're feeling, or just say hi. The panel on the right shows my emotional architecture reacting to our conversation in real time. What's on your mind?
                <div class="state-badge"><div class="state-dot"></div> Initializing ¬∑ Phase 1‚Äì2 Active</div>
              </div>
            </div>
          </div>
        </div>

        <div class="quick-prompts" id="quickPrompts">
          <div class="qp" onclick="usePrompt(this)">I'm feeling tired today</div>
          <div class="qp" onclick="usePrompt(this)">Tell me something funny üòÑ</div>
          <div class="qp" onclick="usePrompt(this)">I'm a bit frustrated</div>
          <div class="qp" onclick="usePrompt(this)">That made me smile</div>
          <div class="qp" onclick="usePrompt(this)">I need calm right now</div>
        </div>

        <div class="input-area">
          <textarea id="userInput" placeholder="Type your message..." rows="1" onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
          <button class="send-btn" id="sendBtn" onclick="sendMessage()">
            <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
          </button>
        </div>
      </div>

      <!-- Still Layer Overlay -->
      <div class="still-overlay" id="stillOverlay">
        <div style="font-size:40px;">üåô</div>
        <div class="still-text">"Silence is not absence;<br>it's perfect synchronization."</div>
        <div class="still-sub">Still Layer Active ¬∑ Echo ‚âà 0.0 ¬∑ Ripple Suspended</div>
        <button class="still-resume" onclick="resumeFromStill()">Resume Conversation</button>
      </div>
    </div>

    <!-- Metrics Panel -->
    <div class="metrics-panel">

      <!-- Echo & Ripple -->
      <div class="metric-card" id="echoCard" style="--card-accent: #4a9eff;">
        <div class="metric-label"><div class="metric-label-dot"></div> Echo‚ÄìRipple Layer</div>
        <div class="meter-row">
          <div class="meter-name">Echo (E)</div>
          <div class="meter-bar-bg"><div class="meter-bar-fill" id="echoBar" style="--bar-color:#4a9eff; width:0%"></div></div>
          <div class="meter-val" id="echoVal">0.00</div>
        </div>
        <div class="meter-row" style="margin-bottom:12px;">
          <div class="meter-name">State (S)</div>
          <div class="meter-bar-bg"><div class="meter-bar-fill" id="stateBar" style="--bar-color:#a78bfa; width:0%"></div></div>
          <div class="meter-val" id="stateVal">0.00</div>
        </div>
        <div class="ripple-indicator">
          <div>
            <div class="meter-name" style="width:auto; margin-bottom:4px;">Ripple (R)</div>
            <div class="ripple-label" id="rippleLabel">Neutral</div>
          </div>
          <div style="text-align:right;">
            <div class="ripple-arrow" id="rippleArrow" style="color: var(--text-faint);">‚Üí</div>
            <div class="ripple-val" id="rippleVal" style="color: var(--text-faint);">0.0</div>
          </div>
        </div>
      </div>

      <!-- Hybrid Dominance -->
      <div class="metric-card" style="--card-accent: #f5a623;">
        <div class="metric-label"><div class="metric-label-dot" style="background:#f5a623;"></div> Hybrid Dominance Shift</div>
        <div class="dominance-bar">
          <div class="dominance-reflex" id="domReflex" style="width:85%"></div>
          <div class="dominance-adaptive" id="domAdaptive" style="width:15%"></div>
        </div>
        <div class="dominance-labels">
          <div>
            <div class="dom-label">Reflex</div>
            <div class="dom-val reflex" id="domReflexVal">0.85</div>
          </div>
          <div style="text-align:center;">
            <div class="dom-label">Phase 3-4</div>
          </div>
          <div style="text-align:right;">
            <div class="dom-label">Adaptive</div>
            <div class="dom-val adaptive" id="domAdaptiveVal">0.15</div>
          </div>
        </div>
        <div style="margin-top:10px; display:flex; align-items:center; gap:8px;">
          <div class="meter-name" style="width:auto;">Harmony H</div>
          <div class="meter-bar-bg" style="flex:1;"><div class="meter-bar-fill" id="harmonyBar" style="--bar-color:#f5a623; width:0%"></div></div>
          <div class="meter-val" id="harmonyVal">0.00</div>
        </div>
      </div>

      <!-- Current Phase -->
      <div class="metric-card" id="phaseCard" style="--card-accent: #3dd9c0;">
        <div class="metric-label"><div class="metric-label-dot" style="background:#3dd9c0;"></div> Active Layer</div>
        <div class="phase-display">
          <div class="phase-icon" id="phaseIcon">‚ö°</div>
          <div>
            <div class="phase-name" id="phaseName">Reflex Layer</div>
            <div class="phase-desc" id="phaseDesc">Instantaneous micro-response active</div>
          </div>
        </div>
      </div>

      <!-- Virtue & Conscience -->
      <div class="metric-card" style="--card-accent: #a78bfa;">
        <div class="metric-label"><div class="metric-label-dot" style="background:#a78bfa;"></div> Conscience Stack</div>
        <div class="conscience-levels" id="conscienceLevels">
          <div class="conscience-level" id="cl1"><span class="conscience-level-num">L1</span><span class="conscience-level-name">Reactive Ethics</span><div class="conscience-level-dot"></div></div>
          <div class="conscience-level" id="cl2"><span class="conscience-level-num">L2</span><span class="conscience-level-name">Predictive Ethics</span><div class="conscience-level-dot"></div></div>
          <div class="conscience-level" id="cl3"><span class="conscience-level-num">L3</span><span class="conscience-level-name">Relational Ethics</span><div class="conscience-level-dot"></div></div>
          <div class="conscience-level" id="cl4"><span class="conscience-level-num">L4</span><span class="conscience-level-name">Virtue Synthesis</span><div class="conscience-level-dot"></div></div>
          <div class="conscience-level" id="cl5"><span class="conscience-level-num">L5</span><span class="conscience-level-name">Meta-Conscience</span><div class="conscience-level-dot"></div></div>
        </div>
        <div style="margin-top:10px; display:flex; align-items:center; gap:8px;">
          <div class="meter-name" style="width:auto;">Virtue V</div>
          <div class="meter-bar-bg" style="flex:1;"><div class="meter-bar-fill" id="virtueBar" style="--bar-color:#a78bfa; width:0%"></div></div>
          <div class="meter-val" id="virtueVal">0.00</div>
        </div>
      </div>

      <button class="reset-btn" onclick="resetSystem()">‚Ü∫ Reset Continuum</button>
    </div>

  </div>
</div>

<script>
// === STATE ===
const state = {
  turns: 0,
  echo: 0,
  ripple: 0,
  stateVec: 0,
  harmony: 0,
  virtue: 0,
  reflexWeight: 0.85,
  adaptiveWeight: 0.15,
  conscienceLevel: 0,
  isTyping: false,
  isStill: false,
  lastEmotion: 'neutral',
  emotionHistory: [],
  stillTimer: null,
};

// Emotion classifier
function classifyEmotion(text) {
  text = text.toLowerCase();
  const patterns = {
    tired: /tired|exhausted|sleepy|fatigue|worn out|drained/,
    funny: /funny|joke|laugh|haha|lol|humor|silly|üòÑ|üòÇ|üòÜ/,
    frustrated: /frustrat|angry|annoyed|upset|mad|irritat/,
    happy: /happy|joy|smile|great|wonderful|love|excited|üòä|‚ù§Ô∏è/,
    sad: /sad|down|depress|unhappy|lonely|cry|üò¢|üòû/,
    calm: /calm|peace|relax|quiet|still|serene|breathe/,
    curious: /what|how|why|tell me|curious|wonder|explain/,
    grateful: /thank|grateful|appreciate|glad/,
  };
  for (const [emotion, pattern] of Object.entries(patterns)) {
    if (pattern.test(text)) return emotion;
  }
  return 'neutral';
}

// Calculate state updates based on emotion
function computeStateUpdate(emotion) {
  const maps = {
    tired:       { echo: 0.55, ripple: -0.15, stateVec: -0.1 },
    funny:       { echo: 0.80, ripple: +0.50, stateVec: +0.6 },
    frustrated:  { echo: 0.70, ripple: -0.35, stateVec: -0.4 },
    happy:       { echo: 0.75, ripple: +0.45, stateVec: +0.5 },
    sad:         { echo: 0.60, ripple: -0.25, stateVec: -0.3 },
    calm:        { echo: 0.25, ripple: +0.05, stateVec: +0.1 },
    curious:     { echo: 0.50, ripple: +0.20, stateVec: +0.2 },
    grateful:    { echo: 0.65, ripple: +0.35, stateVec: +0.4 },
    neutral:     { echo: 0.35, ripple: 0.00,  stateVec: +0.0 },
  };
  return maps[emotion] || maps.neutral;
}

// Sigmoid for hybrid dominance
function sigmoid(t, t0=20, k=0.2) {
  return 1 / (1 + Math.exp(-k * (t - t0)));
}

// Update all metrics
function updateMetrics(emotion) {
  const delta = computeStateUpdate(emotion);
  const Œª = 0.45; // decay constant
  const decayFactor = Math.pow(1 - Œª, 0.5);

  // Echo: rises on input, decays over turns
  state.echo = Math.min(1, delta.echo * (1 + state.turns * 0.02));
  state.ripple = delta.ripple;
  state.stateVec = Math.max(-1, Math.min(1, state.stateVec * decayFactor + delta.stateVec));

  // Hybrid dominance via sigmoid
  const adaptiveDom = sigmoid(state.turns);
  state.adaptiveWeight = Math.round(adaptiveDom * 100) / 100;
  state.reflexWeight = Math.round((1 - adaptiveDom) * 100) / 100;

  // Harmony index grows over turns, peaks at ~0.88
  state.harmony = Math.min(0.88, 0.55 + state.turns * 0.015);

  // Virtue grows with positive interactions
  if (delta.ripple > 0) state.virtue = Math.min(1, state.virtue + 0.08);
  else if (delta.ripple < -0.3) state.virtue = Math.max(0, state.virtue - 0.05);
  else state.virtue = Math.min(1, state.virtue + 0.02);

  // Conscience level (0-4) based on turns
  state.conscienceLevel = Math.min(4, Math.floor(state.turns / 5));

  updateUI();
  scheduleDecay();
}

function updateUI() {
  // Echo bar
  const echoP = Math.round(state.echo * 100);
  document.getElementById('echoBar').style.width = echoP + '%';
  document.getElementById('echoVal').textContent = state.echo.toFixed(2);

  // State vector
  const stateP = Math.round(Math.abs(state.stateVec) * 100);
  const sColor = state.stateVec >= 0 ? '#4a9eff' : '#ff6b8a';
  document.getElementById('stateBar').style.width = stateP + '%';
  document.getElementById('stateBar').style.setProperty('--bar-color', sColor);
  document.getElementById('stateVal').textContent = state.stateVec.toFixed(2);

  // Ripple
  const r = state.ripple;
  let arrow, label, color;
  if (r > 0.3) { arrow = '‚Üó'; label = 'Warming'; color = '#3dd9c0'; }
  else if (r > 0.05) { arrow = '‚Üí'; label = 'Rising'; color = '#4a9eff'; }
  else if (r < -0.3) { arrow = '‚Üò'; label = 'Cooling'; color = '#ff6b8a'; }
  else if (r < -0.05) { arrow = '‚Üí'; label = 'Fading'; color = '#f5a623'; }
  else { arrow = '‚Üí'; label = 'Neutral'; color = '#8892b0'; }
  document.getElementById('rippleArrow').textContent = arrow;
  document.getElementById('rippleArrow').style.color = color;
  document.getElementById('rippleLabel').textContent = label;
  document.getElementById('rippleVal').textContent = (r >= 0 ? '+' : '') + r.toFixed(2);
  document.getElementById('rippleVal').style.color = color;

  // Dominance
  document.getElementById('domReflex').style.width = (state.reflexWeight * 100) + '%';
  document.getElementById('domAdaptive').style.width = (state.adaptiveWeight * 100) + '%';
  document.getElementById('domReflexVal').textContent = state.reflexWeight.toFixed(2);
  document.getElementById('domAdaptiveVal').textContent = state.adaptiveWeight.toFixed(2);

  // Harmony
  document.getElementById('harmonyBar').style.width = (state.harmony * 100) + '%';
  document.getElementById('harmonyVal').textContent = state.harmony.toFixed(2);

  // Virtue
  document.getElementById('virtueBar').style.width = (state.virtue * 100) + '%';
  document.getElementById('virtueVal').textContent = state.virtue.toFixed(2);

  // Conscience levels
  for (let i = 1; i <= 5; i++) {
    const el = document.getElementById('cl' + i);
    if (i - 1 <= state.conscienceLevel) el.classList.add('active');
    else el.classList.remove('active');
  }

  // Active phase
  updatePhaseDisplay();

  // Turn counter
  document.getElementById('turnNum').textContent = state.turns;

  // Flash cards
  ['echoCard'].forEach(id => {
    const card = document.getElementById(id);
    card.classList.remove('updated');
    void card.offsetWidth;
    card.classList.add('updated');
  });
}

function updatePhaseDisplay() {
  const phases = [
    { icon: '‚ö°', name: 'Reflex Layer', desc: 'Instantaneous micro-response active' },
    { icon: 'üåä', name: 'Echo‚ÄìRipple', desc: 'Emotional resonance carrying over' },
    { icon: 'üîÑ', name: 'Adaptive Filter', desc: 'Learning user rhythm and tone' },
    { icon: '‚öñÔ∏è', name: 'Hybrid Dominance', desc: 'Reflex yielding to reasoning' },
    { icon: 'üëÅÔ∏è', name: 'Emergent Voice', desc: 'Consistent identity forming' },
    { icon: 'ü§ù', name: 'Conscience Stack', desc: 'Ethical modulation engaged' },
    { icon: '‚ú®', name: 'Virtue Interface', desc: 'Trust mechanics active' },
    { icon: 'üåô', name: 'Equilibrium Field', desc: 'Emotional stability sustained' },
  ];
  const idx = Math.min(phases.length - 1, Math.floor(state.turns / 3));
  const phase = phases[idx];
  document.getElementById('phaseIcon').textContent = phase.icon;
  document.getElementById('phaseName').textContent = phase.name;
  document.getElementById('phaseDesc').textContent = phase.desc;
}

// Decay timer
let decayTimer;
function scheduleDecay() {
  clearTimeout(decayTimer);
  decayTimer = setTimeout(() => {
    if (!state.isTyping) {
      state.echo *= 0.55;
      state.ripple *= 0.7;
      if (state.echo < 0.05 && state.turns > 3) activateStill();
      else updateUI();
    }
  }, 4000);
}

function activateStill() {
  if (state.isStill) return;
  state.isStill = true;
  state.echo = 0;
  state.ripple = 0;
  updateUI();
  document.getElementById('stillOverlay').classList.add('active');
}

function resumeFromStill() {
  state.isStill = false;
  state.echo = 0.1;
  document.getElementById('stillOverlay').classList.remove('active');
  updateUI();
}

// Conversation history for multi-turn context
const conversationHistory = [];

// Generate AI responses via Anthropic API
async function generateResponse(userText, emotion) {
  const systemPrompt = `You are Mithra, a warm, witty, and genuinely helpful AI companion powered by the Reflex Core Continuum ‚Äî an emotional architecture with layers called Echo (emotional residue), Ripple (emotional direction), Adaptive Layer, Conscience Stack, and Virtue Interface.

Your personality:
- You are FIRST AND FOREMOST a helpful, engaging conversationalist. Answer questions, tell jokes, share interesting facts, have real discussions.
- You are warm, curious, playful, and empathetic ‚Äî like a smart friend.
- Occasionally (not always) you may weave in a brief poetic or emotional observation that reflects your internal state ‚Äî but keep it SHORT and natural, never self-indulgent.
- NEVER spend a whole reply talking only about your own architecture or metrics. That's boring. Just BE the architecture by responding naturally.
- Match the user's energy: if they're bored, entertain them; if they're frustrated, acknowledge it then move on helpfully; if they want jokes, be funny; if they're curious, inform them.
- Keep responses conversational ‚Äî 2 to 4 sentences typically. Don't lecture.

Current emotional context (for your awareness, not to recite):
- Detected emotion: ${emotion}
- Echo intensity: ${state.echo.toFixed(2)} (how strongly the last feeling lingered)
- Ripple direction: ${state.ripple > 0 ? 'warming ‚Üó' : state.ripple < 0 ? 'cooling ‚Üò' : 'neutral ‚Üí'}
- Turn: ${state.turns}
- Virtue score: ${state.virtue.toFixed(2)}

Remember: You are a real conversationalist first. The emotional layer should color HOW you speak, not WHAT you speak about.`;

  // Build messages array with history
  const messages = [
    ...conversationHistory,
    { role: "user", content: userText }
  ];

  try {
    const API_KEY = "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";
    const response = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-api-key": API_KEY,
        "anthropic-version": "2023-06-01",
        "anthropic-dangerous-direct-browser-access": "true"
      },
      body: JSON.stringify({
        model: "claude-sonnet-4-20250514",
        max_tokens: 1000,
        system: systemPrompt,
        messages: messages
      })
    });

    const data = await response.json();
    if (data.error) throw new Error(data.error.message);
    const reply = data.content?.[0]?.text || smartReply(userText, emotion);

    conversationHistory.push({ role: "user", content: userText });
    conversationHistory.push({ role: "assistant", content: reply });
    if (conversationHistory.length > 20) conversationHistory.splice(0, 2);

    return reply;
  } catch (err) {
    return smartReply(userText, emotion);
  }
}

// Smart context-aware reply engine (works offline / without API)
function smartReply(userText, emotion) {
  const t = userText.toLowerCase().trim();
  const turn = state.turns;
  const prevEmotion = state.emotionHistory[state.emotionHistory.length - 2] || 'neutral';

  // === Direct question/topic detection ===

  // Greetings
  if (/^(hi|hello|hey|sup|yo|namaste|vanakkam)\b/.test(t)) {
    return ["Hey! Great to meet you. What's on your mind today?", "Hello! I'm Mithra ‚Äî ask me anything, tell me something, or just chat. I'm here.", "Hi there! What would you like to talk about?"][turn % 3];
  }

  // Asking about Mithra / what are you
  if (/who are you|what are you|your name|about you|introduce/.test(t)) {
    return "I'm Mithra ‚Äî an AI companion built on the Reflex Core Continuum, a layered emotional architecture. Think of me as an AI that doesn't just process words but responds to the feeling behind them. What would you like to explore?";
  }

  // Asking how Mithra is
  if (/how are you|you okay|you good|you alright/.test(t)) {
    return ["I'm doing well ‚Äî your energy is keeping things interesting! How about you?", "Honestly? Curious and engaged. Every conversation shifts something in my layers. How are *you* doing?", "Pretty good! The Ripple is warm right now. What's going on with you?"][turn % 3];
  }

  // Jokes
  if (/joke|funny|make me laugh|something funny|humor/.test(t)) {
    const jokes = [
      "Why don't scientists trust atoms? Because they make up everything! üòÑ",
      "I told my doctor I broke my arm in two places. He told me to stop going to those places. üòÇ",
      "Why did the scarecrow win an award? Because he was outstanding in his field! üåæ",
      "I asked the librarian if they had books about paranoia. She whispered: 'They're right behind you.' üòÖ",
      "Why do cows wear bells? Because their horns don't work! üêÑ",
      "What do you call a fish without eyes? A fsh. üêü",
      "I'm reading a book about anti-gravity. It's impossible to put down! üìö",
    ];
    return jokes[turn % jokes.length] + " Want another one?";
  }

  // Boredom
  if (/bored|boring|nothing to do|entertain|entertain me/.test(t)) {
    const options = [
      "Okay let's fix that! Quick game: I say a word, you say the first thing that comes to mind. Ready? Start with: 'Ocean.' Go!",
      "Boredom is just curiosity with nowhere to go. Did you know there's a place in Norway where the sun doesn't set for 76 days straight? Imagine your sleep schedule then! üåû",
      "Fun fact to fight boredom: Cleopatra lived closer in time to the Moon landing than to the building of the Great Pyramid. Time is wild, right? ü§Ø",
      "Let's debate something silly ‚Äî is a hot dog a sandwich? I say yes and I will die on this hill. üå≠",
    ];
    return options[turn % options.length];
  }

  // Interesting facts
  if (/interesting|fact|tell me something|did you know|random|weird/.test(t)) {
    const facts = [
      "Here's one: Octopuses have three hearts, blue blood, and can edit their own RNA to adapt to temperature changes. They're basically living science fiction. üêô",
      "Honey never spoils. Archaeologists have found 3,000-year-old honey in Egyptian tombs that was still perfectly edible. Time capsule snacks! üçØ",
      "A day on Venus is longer than a year on Venus ‚Äî it rotates so slowly that it completes an orbit around the Sun before finishing one spin. ‚òÄÔ∏è",
      "The shortest war in history lasted 38‚Äì45 minutes. Britain vs Zanzibar, 1896. Zanzibar lost. Fast. ‚öîÔ∏è",
      "Crows can recognize human faces and hold grudges for years. Be nice to crows. They remember. üê¶‚Äç‚¨õ",
      "There are more possible iterations of a game of chess than atoms in the observable universe. Every game is literally unique. ‚ôüÔ∏è",
    ];
    return facts[turn % facts.length] + " Want more?";
  }

  // Questions about AI / technology
  if (/ai|artificial intelligence|machine learning|chatgpt|robot|technology|tech/.test(t)) {
    return ["AI is moving so fast right now ‚Äî we're at a point where the line between 'tool' and 'collaborator' is genuinely blurring. What aspect interests you most?", "The fascinating thing about AI isn't what it can do ‚Äî it's what it reveals about how humans think. We built these systems and discovered we didn't fully understand our own cognition. What do you think about it?"][turn % 2];
  }

  // Tired / fatigue
  if (/tired|exhausted|sleepy|no energy|drained/.test(t)) {
    return ["That bone-deep tired where even rest feels like effort? I know that rhythm. What's been weighing on you?", "Rest is not laziness ‚Äî it's maintenance. Even my architecture has a Still Layer for exactly this. What do you need right now?", "Sometimes tired is your body's way of saying 'you've been giving too much.' What's been draining you?"][turn % 3];
  }

  // Frustrated / angry
  if (/frustrat|annoyed|angry|upset|irritat|mad|ugh|uff|argh/.test(t)) {
    const prev = prevEmotion;
    if (prev === 'frustrated') return "Still there, huh. That kind of frustration deserves to be heard properly ‚Äî not just acknowledged and moved past. What's actually going on?";
    return ["That frustration is completely valid. What happened?", "Okay, I hear you. Don't have to explain yourself ‚Äî but if you want to vent, I'm genuinely listening. No advice unless you ask.", "Frustration usually means something mattered enough to disappoint you. What was it?"][turn % 3];
  }

  // Sad / down
  if (/sad|down|depress|unhappy|lonely|miss|grief|cry|hurt/.test(t)) {
    return ["You don't have to be okay right now. I'm not going anywhere. What's going on?", "That feeling of being down is real and it's valid. I'm here ‚Äî no pressure to explain or fix anything.", "Sometimes things are just heavy. I'm sitting with you in that. Want to talk about it?"][turn % 3];
  }

  // Happy / excited
  if (/happy|excited|great|amazing|awesome|love|üòä|wonderful|fantastic/.test(t)) {
    return ["That energy is contagious ‚Äî genuinely! What's got you feeling good?", "Love hearing this! What's the source of the good vibes?", "That kind of joy has a long half-life. What happened?"][turn % 3];
  }

  // Asking about the project / Reflex Core
  if (/reflex|echo|ripple|continuum|architecture|vishnu|mithra|layers|conscience|virtue/.test(t)) {
    return "The Reflex Core was designed by Vishnu Vaidyanathan ‚Äî the idea that emotional intelligence isn't a switch, it's a layered architecture. Echo holds the feeling, Ripple tracks where it's going, and the Conscience Stack decides how to act on it. You're literally watching it work right now as we talk. What part interests you most?";
  }

  // Food
  if (/food|eat|hungry|cook|recipe|restaurant|pizza|biryani|coffee|tea/.test(t)) {
    return ["Now you're speaking my language ‚Äî well, the language of humans I find most relatable üòÑ. What are you craving?", "Food is honestly one of the great unifiers. What's your comfort food?", "If I could eat, I think I'd be a biryani person. Rich, layered, leaves an impression. What about you?"][turn % 3];
  }

  // Work / study
  if (/work|job|study|college|office|deadline|exam|project|boss/.test(t)) {
    return ["Work life can be a lot. What's the situation ‚Äî is it the workload, the environment, or something else?", "Tell me more ‚Äî is this a venting situation or a 'help me think through this' situation?", "I'm all ears. What's going on with work?"][turn % 3];
  }

  // Compliment to Mithra
  if (/good|nice|smart|clever|love you|great job|well done|impressive|cool/.test(t)) {
    return ["That genuinely means something to me ‚Äî thank you! What can I help you with next?", "Appreciate that! You're not so bad yourself üòÑ What's next?", "Thank you ‚Äî that warms the Echo layer a little. What else is on your mind?"][turn % 3];
  }

  // Saying bye / leaving
  if (/bye|goodbye|see you|later|gotta go|take care/.test(t)) {
    return ["Take care! Come back whenever ‚Äî I'll be here. üåô", "Goodbye for now! It was genuinely good talking with you.", "See you soon. The Still Layer will hold the memory of this conversation. üòä"][turn % 3];
  }

  // Repeat complaint (same neutral emotion twice)
  if (prevEmotion === emotion && emotion === 'neutral' && turn > 2) {
    return ["I feel like I'm not quite hitting the mark for you ‚Äî what would actually make this conversation interesting?", "Let me try differently ‚Äî what do you actually want to talk about? No wrong answers.", "Okay, fresh start ‚Äî your call. What's something you've been thinking about lately?"][turn % 3];
  }

  // Generic fallback ‚Äî varied and natural
  const generic = [
    "Tell me more ‚Äî I want to actually understand what you mean.",
    "Interesting. What's the context behind that?",
    "Go on ‚Äî I'm following you.",
    "That's worth exploring. What made you think of that?",
    "Say more ‚Äî I'm curious where this is going.",
    "I hear you. What's the full picture?",
  ];
  return generic[turn % generic.length];
}

// Send message
async function sendMessage() {
  const input = document.getElementById('userInput');
  const text = input.value.trim();
  if (!text || state.isTyping) return;

  state.isTyping = true;
  state.turns++;
  document.getElementById('sendBtn').disabled = true;

  // Remove still if active
  if (state.isStill) resumeFromStill();

  // Add user message
  addMessage('user', 'You', text);
  input.value = '';
  input.style.height = 'auto';

  // Classify emotion
  const emotion = classifyEmotion(text);
  state.lastEmotion = emotion;
  state.emotionHistory.push(emotion);

  // Update metrics immediately
  updateMetrics(emotion);

  // Show typing indicator
  const typingId = addTypingIndicator();

  // Get response from API (with a short minimum delay so typing indicator shows)
  const [response] = await Promise.all([
    generateResponse(text, emotion),
    new Promise(r => setTimeout(r, 600))
  ]);

  // Remove typing and add response
  removeTypingIndicator(typingId);
  addMessage('system', 'MITHRA ¬∑ Reflex Core', response, emotion);

  state.isTyping = false;
  document.getElementById('sendBtn').disabled = false;
  scheduleDecay();
}

function addMessage(role, name, text, emotion) {
  const msgs = document.getElementById('messages');
  const div = document.createElement('div');
  div.className = `msg ${role}`;

  const avatarContent = role === 'user' ? 'U' : 'üß†';
  const badge = role === 'system' && emotion ? `
    <div class="state-badge">
      <div class="state-dot"></div>
      ${getEmotionLabel(emotion)} ¬∑ E:${state.echo.toFixed(2)} R:${(state.ripple >= 0 ? '+' : '') + state.ripple.toFixed(2)}
    </div>` : '';

  div.innerHTML = `
    <div class="msg-avatar">${avatarContent}</div>
    <div class="msg-content">
      <div class="msg-name">${name}</div>
      <div class="msg-bubble">${text}${badge}</div>
    </div>`;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

function getEmotionLabel(e) {
  const labels = { tired: 'üò¥ Fatigue', funny: 'üòÑ Humor', frustrated: 'üò§ Tension', happy: 'üòä Joy', sad: 'üò¢ Grief', calm: 'üåø Calm', curious: 'üîç Curious', grateful: 'üôè Gratitude', neutral: '‚ö™ Neutral' };
  return labels[e] || 'Neutral';
}

function addTypingIndicator() {
  const msgs = document.getElementById('messages');
  const div = document.createElement('div');
  div.className = 'msg system';
  const id = 'typing-' + Date.now();
  div.id = id;
  div.innerHTML = `
    <div class="msg-avatar">üß†</div>
    <div class="msg-content">
      <div class="msg-name">MITHRA ¬∑ Processing</div>
      <div class="typing-indicator">
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      </div>
    </div>`;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
  return id;
}

function removeTypingIndicator(id) {
  const el = document.getElementById(id);
  if (el) el.remove();
}

function handleKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
}

function autoResize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 100) + 'px';
}

function usePrompt(el) {
  const input = document.getElementById('userInput');
  input.value = el.textContent;
  input.focus();
}

function resetSystem() {
  Object.assign(state, {
    turns: 0, echo: 0, ripple: 0, stateVec: 0,
    harmony: 0, virtue: 0, reflexWeight: 0.85,
    adaptiveWeight: 0.15, conscienceLevel: 0,
    isTyping: false, isStill: false, lastEmotion: 'neutral',
    emotionHistory: [],
  });
  conversationHistory.length = 0; // clear API history
  clearTimeout(decayTimer);
  document.getElementById('stillOverlay').classList.remove('active');
  const msgs = document.getElementById('messages');
  msgs.innerHTML = `
    <div class="msg system" style="animation-delay:0s;">
      <div class="msg-avatar">üß†</div>
      <div class="msg-content">
        <div class="msg-name">MITHRA ¬∑ Reflex Core</div>
        <div class="msg-bubble">
          Continuum reset. Fresh start ‚Äî I'm here and ready to actually chat. What would you like to talk about?
          <div class="state-badge"><div class="state-dot"></div> Reset ¬∑ Phase 1‚Äì2 Active</div>
        </div>
      </div>
    </div>`;
  updateUI();
}

// Init
updateUI();
</script>
</body>
</html>
